<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Interface</title>
    <link rel="stylesheet" href="stylebot.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Back Button (Above Chatbot) -->
    <button id="back-button" class="back-button">Back</button>

    <!-- Main container -->
    <div class="chatbot-container">
        <!-- Header Section -->
        <header class="chatbot-header">
            <h1>Chatbot</h1>
            <div class="light-dark-toggle">
                <div class="sun-container">
                    <img src="./assets/images/icon-sun-dark.svg" alt="Sun Icon">
                </div>
                <label class="light-dark-switch">
                    <input type="checkbox" id="theme-toggle">
                    <span class="slider round"></span>
                </label>
                <div class="moon-container">
                    <img src="./assets/images/icon-moon-dark.svg" alt="Moon Icon">
                </div>
            </div>
        </header>

        <!-- Chat Display Section -->
        <main class="chat-display" id="chat-display">
            <div class="bot-message">
                <div class="message-content">Hello! I'm here to assist you. How can I help?</div>
            </div>
        </main>

        <!-- User Input Section -->
        <form class="chat-input-form" id="chat-form">
            <input type="text" id="user-input" placeholder="Type your message here..." required>
            <button type="submit" class="send-button">Send</button>
        </form>
    </div>

    <!-- JavaScript to Handle Theme Toggle, Chat, and Back Button -->
    <script>
        // Back button functionality
        const backButton = document.getElementById("back-button");
        backButton.addEventListener("click", () => {
            window.history.back();  // Navigate back to the previous page
        });

        // Theme toggle functionality
        const themeToggle = document.getElementById("theme-toggle");
        themeToggle.addEventListener("change", () => {
            if (themeToggle.checked) {
                document.documentElement.setAttribute("data-theme", "dark");
            } else {
                document.documentElement.removeAttribute("data-theme");
            }
        });

        // Function to create a new message
        function createMessage(content, isBot = true) {
            const messageDiv = document.createElement("div");
            messageDiv.classList.add(isBot ? "bot-message" : "user-message");
            messageDiv.innerHTML = `<div class="message-content">${content}</div>`;
            chatDisplay.appendChild(messageDiv);
            chatDisplay.scrollTop = chatDisplay.scrollHeight;
        }

        // Send message to OpenAI's ChatGPT and get response
        async function sendToChatGPT(message) {
            const response = await fetch('https://api.openai.com/v1/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer YOUR_API_KEY_HERE`,  // Replace with your API key
                },
                body: JSON.stringify({
                    model: "gpt-3.5",  // You can use gpt-3.5 or gpt-4 depending on your plan
                    messages: [{ role: "user", content: message }],
                    max_tokens: 150, // Adjust token length according to your needs
                    temperature: 0.7, // Controls the creativity of the response (range 0-1)
                })
            });

            const data = await response.json();
            const botReply = data.choices[0].message.content.trim(); // Bot's response
            return botReply;
        }

        // Chat form submission handler
        const chatForm = document.getElementById("chat-form");
        const chatDisplay = document.getElementById("chat-display");

        chatForm.addEventListener("submit", async function (e) {
            e.preventDefault();
            const userInput = document.getElementById("user-input").value.trim();

            if (userInput) {
                // Display user message
                createMessage(userInput, false);

                // Send the user input to OpenAI's ChatGPT and get the response
                const botResponse = await sendToChatGPT(userInput);

                // Display the bot's response
                createMessage(botResponse);

                // Clear user input
                document.getElementById("user-input").value = "";
            }
        });
    </script>
</body>

</html>
